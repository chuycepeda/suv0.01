{% extends landing_layout %}

<!-- ADD PAGE HEAD ELEMENTS -->
{% block title %}<title>{{app_name}} » Lista de Propuestas</title>{% endblock %}
   
{% block page_css %}
 	<link href="/{{theme}}/materialize/css/prism.css" type="text/css" rel="stylesheet" media="screen,projection">
    <link href="/{{theme}}/materialize/css/plugins/perfect-scrollbar/perfect-scrollbar.css" type="text/css" rel="stylesheet" media="screen,projection">
 	<link href="/{{theme}}/materialize/css/plugins/rrssb/rrssb.css" type="text/css" rel="stylesheet" media="screen,projection">
 	<style>
		.rating:hover{
			color:#ffc107!important;
			transform: scale(1.75);
			-webkit-transform: scale(1.75);
		}

		.rating{
			font-size: 30px;
			transform: scale(1.5);
			-webkit-transform: scale(1.5);
		}

		.create{
			transition-timing-function: ease-in;
    		transition: border 0.3s;
    		-webkit-transition-timing-function: ease-in;
    		-webkit-transition: border 0.3s;
		}

		.create:hover{
			border-bottom: 6px solid {{brand_color}};
		}

		.chip {
		    display: inline-block;
		    height: 32px;
		    font-size: 13px;
		    font-weight: 500;
		    color: rgba(0, 0, 0, 0.6);
		    line-height: 32px;
		    padding: 0 12px;
		    border-radius: 16px;
		    background-color: #e4e4e4;
		}

		.hoverable:hover{
        	box-shadow: #A9A6A6 0px 8px 23px 6px;
        	transition: all .3s ease-out;
        }

        .hoverable{
        	transition: all .3s ease-out;
		}
		h3{
	      line-height: 60px;
	      letter-spacing: 0.2px;
	    }
 	</style>
{% endblock %}

{% block page_components %}
{% endblock %}


{% block header_content %}
<div class="parallax-container" style="max-height:200px;overflow:hidden;margin-bottom: -80px;">
	<div class="section no-pad-bot">
	  <div class="container">
	    <h2 class="header center brand-color-text" style="margin-top:85px;">Propuestas</h2>        
	  </div>
	</div>
</div>
{% endblock %}

{% block body_content %}
	<div class="section">
		<div class="container" style="margin-top:80px">
			<div class="row">
		        <h3 class="col s12 m7 offset-m1 grey-text" style="font-weight: 200">Tu espacio digital para preguntar, proponer, sumar voces y recibir respuestas.</h3>
		        <div class="col card-panel s12 m2 white center create hoverable" style="padding-top: 30px;padding-bottom: 60px;cursor: pointer;" onclick='window.location = "{{uri_for('materialize-petition-new')}}";'>
		          <h2 class="grey-text"><i class="mdi-image-wb-incandescent" style="font-size:34px"></i></h2>
                  <h5 class="brand-color-text" style="font-family: roboto-thin;">Crea una propuesta</h5>
                </div>
	    	</div>
	    	<div class="row">
		        <h5 class="col s12 m10 offset-m1 grey-text"> Cómo funciona <em class="grey-text lighten-2 right" style="font-size:10px">imágenes cortesía del proyecto askthem.io</em></h5>
		        <div class="divider col s12 m10 offset-m1" style="margin-bottom:20px;"></div>
		        <div class="col s12 m10 offset-m1 center">
		        	<div class="col s12 m4">
		        		<img class="reponsive-img col s8 offset-s2" src="/{{theme}}/materialize/images/pet_1.png" alt="pet1">
		        		<h5 class="col s12 grey-text" style="font-weight: 200">I. Seleccionas un tema.</h5>
		        	</div>
		        	<div class="col s12 m4">
		        		<img class="reponsive-img col s8 offset-s2" src="/{{theme}}/materialize/images/pet_2.png" alt="pet2">
		        		<h5 class="col s12 grey-text" style="font-weight: 200">II. Acumulas firmas digitales.</h5>
		        	</div>
		        	<div class="col s12 m4">
		        		<img class="reponsive-img col s8 offset-s2" src="/{{theme}}/materialize/images/pet_3.png" alt="pet3">
		        		<h5 class="col s12 grey-text" style="font-weight: 200">III. Tu gobierno te responde.</h5>
		        	</div>
		        </div>
	    	</div>
			<div class="row">
				<h5 class="col s12 m10 offset-m1 grey-text"> Actividad</h5>
		        <div class="divider col s12 m10 offset-m1" style="margin-bottom:20px;"></div>
		        <div class="col s12 m10 offset-m1 center">
			        <div class="card col s12 m4 hoverable">
	                      <div class="card-content">
	                        <p>
	                         	<span class="left grey-text" style="text-transform:uppercase;font-family: roboto-light;">Hace 0 días</span>
	  							<span class="right brand-color-text" style="text-transform:uppercase">compartir</span>
	  						</p>
	  						<h3 class="truncate" style="margin: 3rem 0 1rem 0; text-align: left; width: 80%;">Title</h3>
	  						<p style="margin-left: 2px; text-align: left;">Description</p>
	  						<div class="chip white-text" style="margin-top: 20px; text-align: left;">Topic</div>
	  						<a class="btn-floating btn-move-up waves-effect waves-light indigo right tooltipped" data-position="top" data-delay="50" data-tooltip="Propuesta oficial" style="top: -80px;">
                        		<i class="mdi-action-verified-user"></i>
                      		</a>
	                      </div>
	                      <div class="card-action center">
	                        <a href="#" style="font-size:20px;margin-right: 0px;" class="col s4 green-text text-accent-2 tooltipped waves-effect waves-light" data-position="top" data-delay="50" data-tooltip="¡Buena idea!">0 <i class="mdi-action-favorite" style="padding-left: 10px;padding-bottom: 20px;font-size: 28px;"></i>
	                        </a>
							
							<a href="#" style="font-size:20px;margin-right: 0px;" class="col s4 amber-text text-accent-2 tooltipped waves-effect waves-light" data-position="top" data-delay="50" data-tooltip="Ver comentarios">0 <i class="mdi-communication-forum" style="padding-left: 10px;padding-bottom: 20px;font-size: 28px;"></i>
							</a>

	                        <a href="#" style="font-size:20px;margin-right: 0px;" class="col s4 red-text text-accent-2 tooltipped waves-effect waves-light" data-position="top" data-delay="50" data-tooltip="Marcar como inapropiado">0 <i class="mdi-content-flag" style="padding-left: 10px;padding-bottom: 20px;font-size: 28px;"></i>
	                        </a>
	                      </div>
	                </div>
	            </div>
				{% for idx, title, when, address_from_coord, address_from, description, status, image_url, group, category, cdb_id, req_deletion, color, rating, follows, log_count, kind in reports %}

				{% endfor %}
			</div>
		</div>
	</div>
	<div id="modal_comments" class="modal white brand-color-text center" style="display: none; opacity: 1; top: 0px;">
          <i class="mdi-navigation-close brand-color-text right modal-action modal-close" style="padding: 10px;"></i>
          <div class="modal-content">
              <div class="row">
                    <div class="input-field col s12 center">
                      <p class="center login-form-text">Este es el historial de cambios de tu reporte. Si tienes algo que agregar, no dudes en comentarlo.</p>
                      <p class="center login-form-text">Para agregar un comentario llena la casilla inferior y da clic en comentar.</p>
                    </div>
                    <div class="row">
                      <div class="container">
                          <div class="row">
							<div class="input-field container col s12" id="report_comments" style="font-weight:bold;">              
                            </div>
                            <div class="row">
		                        <div class="input-field col s12 l6 right">
		                            <i class="mdi-maps-map prefix brand-color-text brand-color-text"></i>
		                            <textarea id="commentbox" name="commentbox" class="materialize-textarea" length="500" style="height: 22px;" type="text" ></textarea>
		                            <label for="commentbox">Escribe aquí tu comentario</label>
		                        </div>
		                    </div> 
                          	<div class="input-field col s12">
                              <a class="btn-large waves-effect waves-light col s4 grey white-text modal-action modal-close" style="cursor:pointer;">Cerrar</a>
                              <a class="btn-large waves-effect waves-light col s4 offset-s4 brand-color white-text" style="cursor:pointer;" id="submit_report_form_comment">Comentar</a>
                            </div>
                          </div>
                      </div>
                    </div>
              </div>
          </div>
    </div>
    <div id="modal_share" class="modal white {{brand_color}}-text center" style="display: none; opacity: 1; top: 0px;">
          <i class="mdi-navigation-close {{brand_color}}-text right modal-action modal-close" style="padding: 10px;"></i>
          <div class="modal-content">
              <div class="row">
                    <div class="input-field col s12 center" style="    margin-bottom: 40px;">
                      <p class="center login-form-text">Comparte el reporte en tu red social favorita.</p>
                    </div>
                    <div class="row">
                      <div class="container">
                          <div id="share_scripts" class="row center">
							<div id="share_content" class="col s8 offset-s2"></div>
                          </div>
                      </div>
                    </div>
              </div>
          </div>
    </div>
{% endblock %}

{% block footer_content %}
{% endblock %}

{% block page_scripts %}
	<script src="/{{theme}}/materialize/js/plugins/rrssb/rrssb.min.js"></script>
	<script type="text/javascript">
			var _req_d = false;
			

			document.querySelector('#submit_report_form_comment').addEventListener('click', function() { 
				if (document.getElementById("commentbox").value == '')
    	            Materialize.toast('<span class="toast-warning">Oops! Escribe un comentario por favor.</span>',4500);
    	        else{
    	        	document.getElementById("comment").value = document.getElementById("commentbox").value;
			        document.getElementById("delete").value = "confirmed_comment";
			        document.getElementById("form_edit_report").submit();
    	        }	            	            
	        });

	        function populateModal(idx){
	        	console.log(idx);
	        	rep_com = document.getElementById('report_comments');

	        	var url = "/report/comments/"+idx+"/";
	        
	            $.ajax({
	                url: url,
	                type: 'GET',
	                success: function(data) { 
	                    console.log(data)
	                }
	            }).done(function(data) {
	                rep_com.innerHTML = data.logs.html;
	                document.getElementById("report_id").value = idx;
	            }); 
	        }

	        function followReport(cdb, idx){
				$.ajax({
	                url: "{{ uri_for('materialize-report-follow') }}",
	                type: 'POST',
	                data: { 
				        'report_id': cdb,
				        'user_id': {{user_id}},
				        '_csrf_token': '{{ csrf_token() }}',
				        'kind': 'unfollow'
				    }
	            }).done(function(data) {
					if (data.contents == 'user already following')
	    				Materialize.toast('<span class="toast-warning">Oops! Tú ya seguías este reporte.</span>',4500);
					else if (data.contents == 'follow request successful')
	    				Materialize.toast('<span class="toast-success">Estás siguiendo este reporte, ahora podrás verlo en tus reportes.</span>',4500);
					else if (data.contents == 'unfollow request successful')
	    				Materialize.toast('<span class="toast-success">Has dejado de seguir este reporte.</span>',4500);
	    			$('#panel_'+idx).hide();
	            });
			}

			function rateReport(idx, rating){
				$.ajax({
	                url: "{{ uri_for('materialize-report-rate') }}",
	                type: 'POST',
	                data: { 
				        'report_id': idx,
				        'user_id': {{user_id}},
				        '_csrf_token': '{{ csrf_token() }}',
				        'rating': rating
				    }
	            }).done(function(data) {
	            	console.log(data);
					if (data.contents == 'rating request successful'){
	    				Materialize.toast('<span class="toast-success">Gracias! Ya hemos recibido tu calificación.</span>',4500);
	    				var colors = []
	    				switch(data.rating){
	    					case 1: colors = ['amber-text','grey-text text-lighten-2','grey-text text-lighten-2','grey-text text-lighten-2','grey-text text-lighten-2'];break;
	    					case 2: colors = ['amber-text','amber-text','grey-text text-lighten-2','grey-text text-lighten-2','grey-text text-lighten-2'];break;
	    					case 3: colors = ['amber-text','amber-text','amber-text','grey-text text-lighten-2','grey-text text-lighten-2'];break;
	    					case 4: colors = ['amber-text','amber-text','amber-text','amber-text','grey-text text-lighten-2'];break;
	    					case 5: colors = ['amber-text','amber-text','amber-text','amber-text','amber-text'];break;
	    				}
	    				document.getElementById('stars_'+idx).innerHTML = '<i class="rating mdi-action-star-rate '+ colors[0] +'" onclick="rateReport('+ idx +',1)"></i><i class="rating mdi-action-star-rate '+ colors[1] +'" onclick="rateReport('+ idx +',2)"></i><i class="rating mdi-action-star-rate '+ colors[2] +'" onclick="rateReport('+ idx +',3)"></i><i class="rating mdi-action-star-rate '+ colors[3] +'" onclick="rateReport('+ idx +',4)"></i><i class="rating mdi-action-star-rate '+ colors[4] +'" onclick="rateReport('+ idx +',5)"></i>';
					}
					else
	    				Materialize.toast('<span class="toast-danger">Oops! Algo ha salido mal, por favor intenta más tarde.</span>',4500);

	            });
			}

			function populateShare(cdb_id){
	        	var _html = ' <ul class="rrssb-buttons"> <li class="rrssb-facebook"><a href="https://www.facebook.com/sharer/sharer.php?u={{uri_for("landing-map", _full=True)}}?cdb_id='+cdb_id+'" class="popup"> <span class="rrssb-icon"> <svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid" width="29" height="29" viewBox="0 0 29 29"> <path d="M26.4 0H2.6C1.714 0 0 1.715 0 2.6v23.8c0 .884 1.715 2.6 2.6 2.6h12.393V17.988h-3.996v-3.98h3.997v-3.062c0-3.746 2.835-5.97 6.177-5.97 1.6 0 2.444.173 2.845.226v3.792H21.18c-1.817 0-2.156.9-2.156 2.168v2.847h5.045l-.66 3.978h-4.386V29H26.4c.884 0 2.6-1.716 2.6-2.6V2.6c0-.885-1.716-2.6-2.6-2.6z" class="cls-2" fill-rule="evenodd"/> </svg> </span> <span class="rrssb-text" style="margin-left: 18px!important;">facebook</span> </a> </li><li class="rrssb-twitter"> <a href="https://twitter.com/intent/tweet?text=Hola!%20sigue%20mi%20reporte%20en%20{{uri_for("landing-map", _full=True)}}?cdb_id='+cdb_id+'&hashtags=#onesmartcity" class="popup"> <span class="rrssb-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28"> <path d="M24.253 8.756C24.69 17.08 18.297 24.182 9.97 24.62c-3.122.162-6.22-.646-8.86-2.32 2.702.18 5.375-.648 7.507-2.32-2.072-.248-3.818-1.662-4.49-3.64.802.13 1.62.077 2.4-.154-2.482-.466-4.312-2.586-4.412-5.11.688.276 1.426.408 2.168.387-2.135-1.65-2.73-4.62-1.394-6.965C5.574 7.816 9.54 9.84 13.802 10.07c-.842-2.738.694-5.64 3.434-6.48 2.018-.624 4.212.043 5.546 1.682 1.186-.213 2.318-.662 3.33-1.317-.386 1.256-1.248 2.312-2.4 2.942 1.048-.106 2.07-.394 3.02-.85-.458 1.182-1.343 2.15-2.48 2.71z"/> </svg> </span> <span class="rrssb-text" style="margin-left: 18px!important;">twitter</span> </a> </li></ul> ';
	        	$('#share_content').html(_html);
	        	setTimeout(function(){ rrssbInit();}, 500);
			}
	</script>
{% endblock %}
